{
  "tasks": [
    {
      "context": "Detection events (people, motion, etc.) are not appearing on the playback timeline. Need to investigate why events aren't displaying - could be an issue with the API response, event positioning calculation, or how the Timeline component renders event markers. The events should appear on the timeline-events-track as colored markers corresponding to when detections occurred.",
      "created_at": "2026-01-01T22:30:31.766807",
      "created_by": "agent",
      "id": "TASK-1",
      "linked_files": [
        "frontend/src/components/Timeline.tsx",
        "frontend/src/components/Timeline.css",
        "frontend/src/pages/PlaybackPage.tsx"
      ],
      "status": "done",
      "title": "Fix timeline view of events",
      "type": "bug",
      "updated_at": "2026-01-02T07:06:12.585076"
    },
    {
      "context": "ML historical detection processing is too slow. Need to investigate bottlenecks and optimize. Potential areas to look at: frame extraction rate, batch processing, GPU utilization, model inference speed, database write performance, and worker scaling.",
      "created_at": "2026-01-01T22:33:28.723008",
      "created_by": "agent",
      "id": "TASK-2",
      "jira_key": "KAN-8",
      "linked_files": [
        "backend/app/services/ml_worker.py",
        "backend/app/services/ml_inference.py",
        "docker-compose.yml"
      ],
      "status": "backlog",
      "title": "Speed up ML historical detection processing",
      "type": "feature",
      "updated_at": "2026-01-02T16:28:09.181259"
    },
    {
      "context": "Automatic migration of recordings between storage tiers based on age/access patterns:\n- Hot: Recent recordings on fast SSD/NVMe for quick access\n- Warm: Older recordings on standard HDD storage  \n- Cold: Archive storage (compressed, possibly external/network storage)\n\nConsiderations:\n- Define retention policies per tier\n- Background worker for migration\n- Transparent access (seamless playback regardless of tier)\n- Storage usage monitoring and alerts\n- Database tracking of recording locations",
      "created_at": "2026-01-01T22:41:23.791523",
      "created_by": "agent",
      "id": "TASK-3",
      "jira_key": "KAN-9",
      "linked_files": [],
      "status": "backlog",
      "title": "Implement tiered storage for recordings (hot/warm/cold)",
      "type": "feature",
      "updated_at": "2026-01-02T16:28:12.924757"
    },
    {
      "context": "Verify the web frontend works correctly on mobile browsers:\n- Responsive layout testing\n- Touch interactions (timeline scrubbing, video controls)\n- Video playback on iOS Safari and Android Chrome\n- Performance on mobile networks\n- UI/UX issues on smaller screens",
      "created_at": "2026-01-01T22:43:31.890164",
      "created_by": "agent",
      "id": "TASK-4",
      "jira_key": "KAN-10",
      "linked_files": [],
      "status": "backlog",
      "title": "Test frontend on mobile devices",
      "type": "chore",
      "updated_at": "2026-01-02T16:28:15.395090"
    },
    {
      "context": "Add ability to collapse/expand the left sidebar that shows the camera list. This would give more screen space for the video player, especially useful on smaller screens or when viewing a single camera. Should include:\n- Toggle button to collapse/expand\n- Smooth animation for collapse transition\n- Persist collapsed state (localStorage or user preference)\n- Keyboard shortcut consideration",
      "created_at": "2026-01-01T22:52:26.488173",
      "created_by": "agent",
      "id": "TASK-5",
      "jira_key": "KAN-11",
      "linked_files": [],
      "status": "done",
      "title": "Make left camera panel collapsible",
      "type": "feature",
      "updated_at": "2026-01-04T19:01:03.042905"
    },
    {
      "context": "Test the new fragmented MP4 recording feature that enables playback of in-progress recordings:\n\n1. Wait for current recording segment to complete and new one to start (or restart recording service)\n2. Go to Playback page, select today's date\n3. Click on the in-progress recording (orange block on timeline)\n4. Verify:\n   - Video plays immediately with red \"LIVE\" badge\n   - Seeking works within recorded portion\n   - Duration updates as recording grows (every 3 seconds)\n5. Test in Chrome, Firefox, Safari\n6. Verify completed recordings still play normally\n\nNote: Only NEW recordings after the backend change will use fMP4 format. Existing in-progress recordings are still old MP4 format and won't be playable until complete.",
      "created_at": "2026-01-02T06:45:32.499128",
      "created_by": "agent",
      "id": "TASK-6",
      "jira_key": "KAN-12",
      "linked_files": [
        "backend/app/services/recorder.py",
        "frontend/src/components/RecordingPlayer.tsx"
      ],
      "status": "backlog",
      "title": "Test fMP4 in-progress recording playback",
      "type": "chore",
      "updated_at": "2026-01-02T16:28:20.482089"
    },
    {
      "context": "Allow users to configure how long recordings are retained before automatic cleanup",
      "created_at": "2026-01-02T08:25:56.150847",
      "created_by": "agent",
      "id": "TASK-7",
      "linked_files": [],
      "status": "done",
      "title": "Add file retention policy configuration to setup page",
      "type": "feature",
      "updated_at": "2026-01-02T08:54:59.289861"
    },
    {
      "context": "Transcoding worker is significantly slower when running in Docker compared to command line execution:\n- Command line: ~5x realtime speed\n- Docker worker: Much slower (needs measurement)\n\nInvestigation areas:\n1. Add detailed logging including ffmpeg output to diagnose bottlenecks\n2. Compare GPU utilization between CLI and Docker environments\n3. Check for I/O bottlenecks (volume mounts, network storage)\n4. Verify NVENC encoder is being used in both cases\n5. Check for resource contention with other services\n6. Review Docker resource limits and GPU passthrough settings\n\nDebugging steps:\n- Add ffmpeg stderr/stdout logging to worker\n- Log transcoding speed metrics (input duration vs processing time)\n- Add GPU utilization logging during transcode jobs\n- Compare identical file transcoding in both environments",
      "created_at": "2026-01-02T16:16:48.613518",
      "created_by": "agent",
      "id": "TASK-8",
      "jira_key": "KAN-5",
      "linked_files": [
        "backend/transcode_worker.py",
        "docker-compose.yml"
      ],
      "status": "backlog",
      "title": "Debug and optimize transcoding worker performance",
      "type": "bug",
      "updated_at": "2026-01-02T16:27:05.704983"
    },
    {
      "context": "In-progress recordings should be playable (allowing users to view footage from minutes ago while still recording), but the player shows \"couldn't load the video\" error.\n\nThis is related to TASK-6 (test fMP4 in-progress recording playback) but is a bug fix rather than testing.\n\nInvestigation areas:\n1. Verify fMP4 fragmented recording format is being used correctly\n2. Check if the backend is serving partial files correctly\n3. Verify Content-Range headers for streaming incomplete files\n4. Check frontend RecordingPlayer handling of in-progress recordings\n5. Verify the recording is detectable as \"in_progress\" vs \"completed\"\n6. Check browser compatibility with fragmented MP4 streaming\n\nSymptoms:\n- In-progress recordings appear on timeline (orange block)\n- Clicking to play shows error \"couldn't load the video\"\n- Completed recordings play normally",
      "created_at": "2026-01-02T16:19:57.689020",
      "created_by": "agent",
      "id": "TASK-9",
      "jira_key": "KAN-6",
      "linked_files": [
        "backend/app/services/recorder.py",
        "backend/app/api/playback.py",
        "frontend/src/components/RecordingPlayer.tsx"
      ],
      "status": "backlog",
      "title": "Fix playback of in-progress recordings",
      "type": "bug",
      "updated_at": "2026-01-02T16:27:08.856617"
    },
    {
      "context": "Detection events (from ML processing) should display as markers on the bottom of the playback screen timeline, but this feature is currently broken.\n\nExpected behavior:\n- When an object/event is detected in a recording, a marker should appear on the timeline\n- User can see at a glance where interesting events occurred\n- Clicking markers could jump to that timestamp\n\nInvestigation areas:\n1. Check if detection events are being saved to the database correctly\n2. Verify the API endpoint returns detection events for recordings\n3. Check if frontend is fetching and rendering the markers\n4. Look for recent changes that may have broken this feature\n5. Verify the Timeline component still has marker rendering code\n\nThis was working previously, so likely a regression from recent changes.",
      "created_at": "2026-01-02T16:21:28.533013",
      "created_by": "agent",
      "id": "TASK-10",
      "jira_key": "KAN-7",
      "linked_files": [
        "frontend/src/components/Timeline.tsx",
        "frontend/src/pages/PlaybackPage.tsx",
        "backend/app/api/playback.py"
      ],
      "status": "backlog",
      "title": "Fix detection event markers on playback timeline",
      "type": "bug",
      "updated_at": "2026-01-02T16:27:20.217765"
    },
    {
      "context": "Add ability to send SMS alerts when live detection identifies objects/events. Needs to integrate with live-detection worker and support configurable notification rules.",
      "created_at": "2026-01-04T17:16:29.085436",
      "created_by": "agent",
      "id": "TASK-11",
      "jira_key": null,
      "linked_files": [],
      "status": "active",
      "title": "SMS notifications for real-time event detection",
      "type": "feature",
      "updated_at": "2026-01-04T17:16:29.085436"
    },
    {
      "context": "Video player shows \"Failed to load video\" when trying to view a recording that is still in progress. The UI correctly shows \"Recording in progress...\" with size (76.3 MB) but the video stream fails to load. Users need this to review recent footage without waiting for 15-minute segment completion.",
      "created_at": "2026-01-04T18:13:22.991065",
      "created_by": "agent",
      "id": "TASK-12",
      "jira_key": "KAN-13",
      "linked_files": [],
      "status": "done",
      "title": "Fix live playback of in-progress recordings",
      "type": "bug",
      "updated_at": "2026-01-04T18:40:38.890729"
    },
    {
      "context": "Enable motion detection on live camera streams. The MotionDetector class already exists (MOG2 background subtraction) but only runs in historical ml_worker. Need to integrate it into live_detection_worker.py with per-camera detector instances, cooldown handling, and proper cleanup.",
      "created_at": "2026-01-04T19:52:23.263595",
      "created_by": "agent",
      "id": "TASK-13",
      "jira_key": null,
      "linked_files": [
        "backend/live_detection_worker.py",
        "backend/app/services/ml/motion_detector.py"
      ],
      "status": "done",
      "title": "Add real-time motion detection to live detection worker",
      "type": "feature",
      "updated_at": "2026-01-04T20:02:45.600596"
    },
    {
      "context": "User reports performance issues with video playback/download. Need to investigate:\n- Streaming latency for recorded video\n- Download speed bottlenecks\n- Potential issues with segment serving, range requests, or transcoding\n- Database query performance for playback metadata",
      "created_at": "2026-01-04T22:20:12.124311",
      "created_by": "agent",
      "id": "TASK-14",
      "jira_key": "KAN-15",
      "linked_files": [
        "backend/app/api/playback.py",
        "backend/app/services/playback.py",
        "backend/transcode_worker.py"
      ],
      "status": "done",
      "title": "Investigate performance problems when downloading or streaming recorded video",
      "type": "bug",
      "updated_at": "2026-01-05T06:25:52.166306"
    },
    {
      "context": "When playing an in-progress recording (e.g., 5 minutes long), the video shows only ~10 seconds then jumps back to 0 repeatedly. Likely issue with fragmented MP4 serving or how the player handles growing files.",
      "created_at": "2026-01-04T22:20:45.779577",
      "created_by": "agent",
      "id": "TASK-15",
      "jira_key": "KAN-14",
      "linked_files": [
        "backend/app/services/playback.py",
        "backend/app/api/playback.py",
        "frontend/src/components/RecordingPlayer.tsx"
      ],
      "status": "done",
      "title": "Fix in-progress recording playback - timeline jumps erratically",
      "type": "bug",
      "updated_at": "2026-01-04T22:36:02.410368"
    },
    {
      "context": "With 4 uvicorn workers, each worker has its own memory space and starts its own ffmpeg processes per camera. This causes 4x the connections to each camera. Need to either: 1) Use shared state (Redis/file locks), 2) Run streaming in a separate singleton process, or 3) Reduce to 1 worker for now",
      "created_at": "2026-01-05T06:57:39.370652",
      "created_by": "agent",
      "id": "TASK-16",
      "jira_key": "KAN-16",
      "linked_files": [
        "backend/Dockerfile",
        "backend/app/services/streaming.py",
        "backend/app/services/recorder.py"
      ],
      "status": "done",
      "title": "Fix duplicate ffmpeg processes with multiple uvicorn workers",
      "type": "bug",
      "updated_at": "2026-01-05T07:58:08.313034"
    },
    {
      "context": "User reports motion and object detection events aren't appearing in the timeline UI. Need to investigate the data flow from detection storage to timeline display.",
      "created_at": "2026-01-05T08:03:16.106618",
      "created_by": "agent",
      "id": "TASK-17",
      "jira_key": null,
      "linked_files": [],
      "status": "done",
      "title": "Detection events not showing in timeline",
      "type": "bug",
      "updated_at": "2026-01-05T08:31:45.613451"
    },
    {
      "context": "Add UI controls to the ML tab to configure:\n1. Confidence threshold (both historical and live detection)\n2. Which object classes to detect (person, car, dog, etc.)\n\nCurrently these are env-only settings. Need to:\n- Create database table for persistent settings (or use existing ml_models table)\n- Add API endpoints to get/update ML configuration\n- Build UI components with sliders/checkboxes for the settings",
      "created_at": "2026-01-05T08:45:45.612951",
      "created_by": "agent",
      "id": "TASK-18",
      "jira_key": null,
      "linked_files": [
        "backend/app/api/ml.py",
        "backend/app/config.py",
        "frontend/src/pages/MLStatusPage.tsx",
        "backend/app/schemas/ml.py"
      ],
      "status": "done",
      "title": "Make ML confidence level and detected features configurable in UI",
      "type": "feature",
      "updated_at": "2026-01-05T09:36:21.699134"
    },
    {
      "context": "User reports: 1) Status page shows negative space saved (incorrect), 2) Transcode worker much slower than manual CLI runs (5x speedup manually), 3) 3 workers should keep up but falling behind, 4) CPU/GPU stats look fine. Need to investigate transcode worker code and space calculation logic.",
      "created_at": "2026-01-05T09:50:00.692654",
      "created_by": "agent",
      "id": "TASK-19",
      "jira_key": null,
      "linked_files": [],
      "status": "done",
      "title": "Transcode worker showing negative space saved and running slower than expected",
      "type": "bug",
      "updated_at": "2026-01-05T12:34:04.695674"
    },
    {
      "context": "The motion/object detection events section on the playback timeline page is not always visible. The section height depends on the video aspect ratio - when the window is wide, the video takes up more vertical space and pushes the events section out of view. Need to give this section a fixed height or make it scale properly.",
      "created_at": "2026-01-05T12:47:51.390421",
      "created_by": "agent",
      "id": "TASK-20",
      "jira_key": null,
      "linked_files": [],
      "status": "done",
      "title": "Fix timeline events section visibility on playback page",
      "type": "bug",
      "updated_at": "2026-01-05T12:49:04.198498"
    },
    {
      "context": "FFmpeg showing \"No decoder surfaces left\" errors even with no other GPU processes. Also seeing DTS/PTS timestamp warnings. Need to: 1) Log FFmpeg stderr even on success, 2) Add verbose/progress mode, 3) Investigate NVDEC surface exhaustion - may need -extra_hw_frames flag, 4) Consider -fflags +genpts for corrupt timestamps",
      "created_at": "2026-01-05T14:03:43.885746",
      "created_by": "agent",
      "id": "TASK-21",
      "jira_key": null,
      "linked_files": [
        "backend/transcode_worker.py"
      ],
      "status": "done",
      "title": "Improve transcode worker logging and debug NVDEC surface exhaustion",
      "type": "bug",
      "updated_at": "2026-01-05T14:05:07.735336"
    },
    {
      "context": "User reported that changing transport to UDP in the camera settings UI didn't work. Need to verify: 1) UI properly sends transport field in PUT request, 2) Backend correctly updates database, 3) Stream manager picks up the change (may need stream restart). Ubiquiti cameras (7,8,9,10) require UDP transport.",
      "created_at": "2026-01-05T16:21:35.545976",
      "created_by": "agent",
      "id": "TASK-22",
      "jira_key": null,
      "linked_files": [
        "frontend/src/components/CameraSettingsModal.tsx",
        "backend/app/api/cameras.py",
        "backend/app/schemas/camera.py"
      ],
      "status": "backlog",
      "title": "Verify UDP transport switch works from camera settings UI",
      "type": "chore",
      "updated_at": "2026-01-05T16:21:35.545976"
    },
    {
      "context": "Make recent detections list clickable and show snapshot preview when selected. The LiveDetection type already has snapshot_url field. Need to add selection state and a preview panel in the bottom-right area of the ML page.",
      "created_at": "2026-01-05T16:25:15.603069",
      "created_by": "agent",
      "id": "TASK-23",
      "jira_key": null,
      "linked_files": [
        "frontend/src/pages/MLStatusPage.tsx",
        "frontend/src/pages/MLStatusPage.css"
      ],
      "status": "done",
      "title": "Add clickable detection list with snapshot preview panel",
      "type": "feature",
      "updated_at": "2026-01-05T16:26:35.123188"
    },
    {
      "context": "Currently snapshot images are served without authentication for simplicity (img src tags can't include Authorization headers). Consider using fetch() with auth headers to get image blobs and convert to object URLs, or implement a token-based query parameter auth scheme. This would restore security for the /api/ml/snapshots endpoint.",
      "created_at": "2026-01-05T16:57:06.665065",
      "created_by": "agent",
      "id": "TASK-24",
      "jira_key": null,
      "linked_files": [
        "backend/app/api/ml.py",
        "frontend/src/pages/MLStatusPage.tsx"
      ],
      "status": "backlog",
      "title": "Add authentication for snapshot images",
      "type": "debt",
      "updated_at": "2026-01-05T16:57:06.665065"
    },
    {
      "context": "Recording watcher fails with UniqueViolationError when a recording already exists in the database. The error cascades because the session isn't rolled back properly, causing subsequent inserts to fail. Need to either check for existing records before insert, or handle the IntegrityError gracefully.",
      "created_at": "2026-01-05T16:58:36.286856",
      "created_by": "agent",
      "id": "TASK-25",
      "jira_key": null,
      "linked_files": [
        "backend/app/services/ml/recording_watcher.py"
      ],
      "status": "done",
      "title": "Fix duplicate key error in recording watcher",
      "type": "bug",
      "updated_at": "2026-01-05T16:59:30.595723"
    },
    {
      "context": "After handling IntegrityError, subsequent queries return \"Multiple rows found\" error. This may be due to SQLAlchemy identity map retaining stale objects. Need to use .first() instead of .scalar_one_or_none() or expire/clear identity map.",
      "created_at": "2026-01-05T17:22:56.019126",
      "created_by": "agent",
      "id": "TASK-26",
      "jira_key": null,
      "linked_files": [
        "backend/app/services/ml/recording_watcher.py"
      ],
      "status": "done",
      "title": "Fix \"Multiple rows found\" error in recording watcher",
      "type": "bug",
      "updated_at": "2026-01-05T17:25:57.587142"
    },
    {
      "context": "Motion detection is broken in live detection - MOG2 needs continuous frames but only gets 1 frame per 2-second segment. Solution: Scale to 720p, extract at 3fps, use frame differencing as gate before YOLO, process cameras in parallel.",
      "created_at": "2026-01-05T19:04:57.877396",
      "created_by": "agent",
      "id": "TASK-27",
      "jira_key": null,
      "linked_files": [
        "backend/live_detection_worker.py",
        "backend/app/services/ml/motion_gate.py",
        "backend/app/config.py",
        "backend/app/models/ml_settings.py",
        "backend/app/schemas/ml.py"
      ],
      "status": "done",
      "title": "Fix motion detection with motion-gated YOLO at 3fps",
      "type": "feature",
      "updated_at": "2026-01-05T19:11:15.203463"
    },
    {
      "context": "Plan and implement an advanced video player component with:\n- Live video streaming with ability to scrub back and return to live\n- Timeline showing motion/detection events\n- Toggleable bounding boxes for detected objects\n- Smooth seeking and playback controls",
      "created_at": "2026-01-05T22:37:24.088288",
      "created_by": "agent",
      "id": "TASK-28",
      "jira_key": null,
      "linked_files": [],
      "status": "done",
      "title": "Design sophisticated video player with timeline, live/DVR, and detection overlays",
      "type": "feature",
      "updated_at": "2026-01-06T00:12:37.681518"
    },
    {
      "context": "UDP RTSP streams (Ubiquiti cameras) occasionally have packet loss causing frame corruption (vertical streaking). Two issues:\n1. Corrupted frames trigger false motion detections\n2. Browser fails to decode and shows error screen instead of recovering\n\nNeed to:\n1. Detect corruption patterns in live_detection_worker.py and skip motion detection\n2. Improve HLS player error handling to recover from decode errors instead of showing error state",
      "created_at": "2026-01-06T10:52:28.083999",
      "created_by": "agent",
      "id": "TASK-29",
      "jira_key": null,
      "linked_files": [
        "backend/live_detection_worker.py",
        "frontend/src/components/UnifiedVideoPlayer/hooks/useHlsPlayer.ts"
      ],
      "status": "done",
      "title": "Handle corrupted video frames gracefully",
      "type": "bug",
      "updated_at": "2026-01-06T11:00:17.809109"
    },
    {
      "context": "Implement ONVIF integration for: 1) Auto-detecting RTSP stream paths from camera media profiles (priority), 2) Receiving camera motion events for instant edge alerts. Both ONVIF events and ML detections run in parallel in unified timeline. Key phases: Foundation (deps, client service), Database (camera/detection model changes), Probe API, Frontend UI, Event Worker.",
      "created_at": "2026-01-06T20:52:44.183990",
      "created_by": "agent",
      "id": "TASK-30",
      "jira_key": null,
      "linked_files": [
        "backend/app/models/camera.py",
        "backend/app/models/detection.py",
        "backend/app/api/ml.py",
        "frontend/src/components/CameraModal.tsx",
        "frontend/src/components/Timeline.tsx"
      ],
      "status": "active",
      "title": "Add ONVIF protocol support for camera discovery and events",
      "type": "feature",
      "updated_at": "2026-01-06T20:52:44.183990"
    }
  ],
  "version": "0.1"
}
